<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Sadew Coffee ‚Äî Shop (with Cart & Checkout)</title>
<style>
/* ---------- Variables ---------- */
:root{
  --bg:#1b1310;
  --card:#2a1f1b;
  --text:#e6dccf;
  --accent:#d7b48a;
  --accent2:#f2c37f;
  --accent-blue:rgba(0,123,255,0.45);
  --shadow:0 6px 22px rgba(0,0,0,0.45);
  --glass: rgba(255,255,255,0.04);
}
[data-theme="light"]{
  --bg:#f4f0eb;
  --card:#ffffff;
  --text:#2a1f1b;
  --accent:#6d4c41;
  --accent2:#8d6e63;
  --accent-blue:rgba(3,102,214,0.18);
  --shadow:0 6px 18px rgba(0,0,0,0.12);
  --glass: rgba(0,0,0,0.03);
}
*{box-sizing:border-box;scroll-behavior:smooth}
body{
  margin:0;
  font-family:Inter, "Poppins", sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:background .35s,color .35s;
  -webkit-font-smoothing:antialiased;
}

/* ---------- NAVBAR ---------- */
.header {
  position:sticky; top:0; z-index:1200;
  background: linear-gradient(180deg, rgba(0,0,0,0.25), transparent);
  backdrop-filter: blur(6px);
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 18px; border-bottom:1px solid rgba(255,255,255,0.02);
}
.brand { display:flex; align-items:center; gap:10px; }
.brand .logo {
  width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; box-shadow:0 4px 12px rgba(0,0,0,0.25);
}
.brand h1 { font-size:1.15rem; margin:0; color:var(--accent2); letter-spacing:0.6px; }

/* nav area */
.nav {
  display:flex; align-items:center; gap:12px; position:relative;
}
.nav-links { display:flex; gap:12px; align-items:center; }
.nav-links a {
  color:var(--text); text-decoration:none; font-weight:600; padding:8px 6px; position:relative;
  transition:color .25s, transform .18s;
  border-radius:6px;
}
.nav-links a:hover { color:var(--accent2); transform:translateY(-2px); }
.nav-links a::after {
  content:""; position:absolute; left:8px; right:8px; bottom:6px; height:3px; background:transparent; border-radius:3px; transform:scaleX(0); transform-origin:left; transition:transform .25s, background .25s;
}
.nav-links a:hover::after { transform:scaleX(1); background:var(--accent2); }
.nav-links a.active { color:var(--accent2); }
.nav-links a.active::after { transform:scaleX(1); background:var(--accent2); }

/* theme toggle */
.theme-toggle { background:none; border:1px solid rgba(255,255,255,0.06); color:var(--accent2); padding:8px 10px; border-radius:8px; cursor:pointer; }

/* cart icon */
.cart-btn { position:relative; background:var(--glass); border-radius:8px; padding:8px; border:1px solid rgba(255,255,255,0.02); cursor:pointer; display:flex; align-items:center; gap:8px; color:var(--text); }
.cart-badge { position:absolute; top:-6px; right:-6px; background:var(--accent2); color:#111; font-weight:800; font-size:0.75rem; padding:3px 6px; border-radius:999px; }

/* hamburger */
.hamburger { display:none; width:36px; height:36px; align-items:center; justify-content:center; border-radius:8px; background:var(--glass); cursor:pointer; border:1px solid rgba(255,255,255,0.02); }
.hamburger div{ width:18px; height:2px; background:var(--text); margin:3px 0; transition:all .25s; }

/* mobile nav panel */
@media(max-width:820px){
  .nav-links{ position:fixed; top:68px; right:14px; background:var(--bg); flex-direction:column; gap:8px; padding:14px; border-radius:12px; box-shadow:var(--shadow); transform:translateY(-10px) scale(.98); opacity:0; pointer-events:none; transition:all .25s; }
  .nav-links.open{ transform:translateY(0) scale(1); opacity:1; pointer-events:auto; }
  .hamburger{ display:flex; }
  .theme-toggle{ display:none; }
}

/* ---------- MAIN LAYOUT / SECTIONS ---------- */
.container { max-width:1100px; margin:24px auto; padding:0 18px; }
.section { margin-bottom:48px; }
.section h2 { margin:0; color:var(--accent2); text-align:center; font-size:1.6rem; }

/* ---------- PRODUCT GRID ---------- */
.product-grid {
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:20px;
  margin-top:22px;
}
.product-card{
  position:relative;
  background:var(--card);
  border-radius:12px;
  overflow:hidden;
  box-shadow:var(--shadow);
  transition:transform .25s, box-shadow .25s;
  display:flex; flex-direction:column; align-items:stretch;
}
.product-card:hover{ transform:translateY(-6px); }
.product-thumb { width:100%; height:200px; display:block; object-fit:cover; }
.product-body { padding:12px 14px; display:flex; flex-direction:column; gap:8px; flex:1; }
.product-title { font-weight:700; color:var(--text); margin:0; }
.product-price { color:var(--accent2); font-weight:800; font-size:1.02rem; }
.card-actions { display:flex; gap:8px; margin-top:auto; align-items:center; }

/* buy button */
.btn {
  background:linear-gradient(90deg,var(--accent) 0%, var(--accent2) 100%);
  border:none; color:#fff; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:700;
  box-shadow:0 6px 14px rgba(0,0,0,0.25);
}
.btn.secondary { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); }

/* blue overlay effect (hover + touch) */
.product-card::after{
  content:"";
  position:absolute; inset:0;
  background: var(--accent-blue);
  opacity:0;
  transition:opacity .25s;
  pointer-events:none;
}
.product-card:hover::after,
.product-card.touch-active::after{ opacity:1; }

/* ---------- CART SIDEBAR ---------- */
.cart-sidebar {
  position:fixed; top:0; right:-420px; width:380px; max-width:94%; height:100vh; background:var(--card); box-shadow: -20px 0 60px rgba(0,0,0,0.6);
  transition:right .28s; z-index:1500; padding:18px; overflow:auto;
}
.cart-sidebar.open { right:0; }
.cart-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
.cart-items { display:flex; flex-direction:column; gap:12px; margin-bottom:12px; }
.cart-item { display:flex; gap:10px; align-items:center; background:rgba(0,0,0,0.03); padding:8px; border-radius:8px; }
.cart-item img{ width:64px; height:64px; object-fit:cover; border-radius:8px; }
.qty-controls { display:flex; gap:6px; align-items:center; }

/* totals */
.cart-summary { border-top:1px dashed rgba(255,255,255,0.04); padding-top:12px; display:flex; flex-direction:column; gap:8px; }
.cart-summary .row { display:flex; justify-content:space-between; align-items:center; }

/* ---------- BUY MODAL (existing) ---------- */
.modal-backdrop {
  position:fixed; inset:0; background:rgba(0,0,0,0.55); display:flex; align-items:center; justify-content:center;
  z-index:1400; opacity:0; pointer-events:none; transition:opacity .18s;
}
.modal-backdrop.open { opacity:1; pointer-events:auto; }
.modal {
  width:360px; max-width:92%; background:var(--card); color:var(--text); border-radius:12px; padding:18px; box-shadow:var(--shadow);
}
.modal h3{ margin:0 0 8px 0; color:var(--accent2); }
.modal .row{ display:flex; align-items:center; gap:10px; margin:10px 0; }
.qty-input { width:80px; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:none; color:var(--text); text-align:center; }
.modal .total { font-weight:800; font-size:1.1rem; color:var(--accent2); text-align:right; }

/* close button */
.close-btn { position:absolute; top:10px; right:12px; background:transparent; border:none; color:var(--text); font-weight:700; cursor:pointer; }

/* ---------- REVIEWS ---------- */
.reviews { display:flex; gap:18px; flex-wrap:wrap; margin-top:16px; }
.review { background:var(--card); padding:12px; border-radius:10px; box-shadow:var(--shadow); width:100%; }
.review small { color:#b9a; }

/* ---------- FOOTER ---------- */
.footer { text-align:center; margin:28px 0 60px; color:#c8bbaa; }

/* ---------- UTIL ---------- */
.hidden { display:none; }
@media (max-width:520px){
  .product-thumb{ height:160px; }
  .modal { width: 92%; }
  .cart-sidebar{ width:92%; }
}
</style>
</head>
<body>

<!-- HEADER / NAV -->
<header class="header" role="banner">
  <div class="brand">
    <div class="logo">SC</div>
    <h1>Sadew Coffee</h1>
  </div>

  <div class="nav">
    <div class="nav-links" id="navLinks" aria-label="Main Navigation">
      <a href="#products" data-target="products">Products</a>
      <a href="#reviews" data-target="reviews">Reviews</a>
      <a href="#contact" data-target="contact">Contact</a>
      <a href="#admin" data-target="admin">Admin</a>
    </div>

    <button class="theme-toggle" id="themeToggle" title="Toggle theme">üåô</button>

    <button class="cart-btn" id="openCartBtn" aria-label="Open cart">
      üõí Cart <span id="cartCount" class="cart-badge" style="display:none">0</span>
    </button>

    <button class="hamburger" id="hamburger" aria-label="Toggle menu">
      <div></div><div></div><div></div>
    </button>
  </div>
</header>

<!-- MAIN -->
<main class="container">

  <!-- PRODUCTS -->
  <section id="products" class="section">
    <h2>Coffee Packages</h2>
    <div class="product-grid" id="productGrid"></div>
  </section>

  <!-- REVIEWS -->
  <section id="reviews" class="section">
    <h2>‡∂¥‡∑è‡∂ª‡∑í‡∂∑‡∑ù‡∂ú‡∑í‡∂ö ‡∂Ö‡∂Ø‡∑Ñ‡∑É‡∑ä</h2>
    <div id="reviewsWrapper">
      <div class="reviews" id="reviewList"></div>

      <div style="margin-top:12px; max-width:480px;">
        <div style="background:var(--card); padding:12px; border-radius:10px; box-shadow:var(--shadow);">
          <h4 style="margin:0 0 8px 0; color:var(--accent2)">‡∂î‡∂∂‡∑ö ‡∂Ö‡∂Ø‡∑Ñ‡∑É ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±</h4>
          <input id="reviewName" placeholder="‡∂±‡∂∏" style="width:100%; padding:8px; border-radius:8px; margin-bottom:8px; border:1px solid rgba(255,255,255,0.04); background:none; color:var(--text)">
          <input id="reviewRating" type="number" min="1" max="5" placeholder="Rating (1-5)" style="width:100%; padding:8px; border-radius:8px; margin-bottom:8px;">
          <textarea id="reviewText" placeholder="‡∂î‡∂∂‡∑ö ‡∂Ö‡∂Ø‡∑Ñ‡∑É..." style="width:100%; padding:8px; border-radius:8px; margin-bottom:8px; min-height:90px;"></textarea>
          <button class="btn" id="submitReview">Submit Review</button>
        </div>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section id="contact" class="section">
    <h2>Contact</h2>
    <p style="text-align:center; color:var(--text);">
      ‚òéÔ∏è <strong>+94 77 123 4567</strong><br>
      üìç <strong>123 Coffee Street, Kandy</strong><br>
      üìß <strong>info@sadewcoffee.lk</strong>
    </p>
  </section>

  <!-- ADMIN -->
  <section id="admin" class="section">
    <h2>Admin Panel</h2>
    <div style="max-width:720px;">
      <div style="background:var(--card); padding:12px; border-radius:10px; box-shadow:var(--shadow);">
        <label>Admin Password: </label>
        <input id="adminPass" type="password" placeholder="Enter password" style="padding:8px; border-radius:8px; margin-left:8px;">
        <button class="btn secondary" id="adminLogin">Login</button>

        <div id="adminPanel" class="hidden" style="margin-top:12px;">
          <h4 style="color:var(--accent2)">Manage Reviews</h4>
          <div id="adminReviews"></div>
        </div>
      </div>
    </div>
  </section>

</main>

<!-- CART SIDEBAR -->
<aside id="cartSidebar" class="cart-sidebar" aria-hidden="true">
  <div class="cart-header">
    <h3 style="margin:0; color:var(--accent2)">Your Cart</h3>
    <button class="close-btn" id="closeCartBtn">‚úï</button>
  </div>
  <div class="cart-items" id="cartItems"></div>

  <div class="cart-summary">
    <div class="row"><div>Subtotal</div><div id="cartSubtotal">Rs. 0</div></div>
    <div class="row"><div>Delivery (est.)</div><div id="cartDelivery">Rs. 150</div></div>
    <div class="row" style="font-weight:800; font-size:1.05rem;"><div>Total</div><div id="cartTotal">Rs. 0</div></div>

    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn" id="checkoutBtn">Checkout</button>
      <button class="btn secondary" id="clearCartBtn">Clear</button>
    </div>
  </div>
</aside>

<!-- BUY MODAL (single-item) -->
<div id="buyModalBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <button class="close-btn" id="modalClose">‚úï</button>
    <h3 id="modalTitle">Buy Product</h3>

    <div style="display:flex; gap:12px; align-items:center;">
      <img id="modalImg" src="" alt="" style="width:84px; height:84px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,0.04)">
      <div style="flex:1;">
        <div id="modalName" style="font-weight:800; color:var(--text)"></div>
        <div id="modalPrice" style="color:var(--accent2); font-weight:800; margin-top:6px"></div>
      </div>
    </div>

    <div class="row" style="margin-top:12px; justify-content:space-between; align-items:center;">
      <label>Quantity:</label>
      <input id="modalQty" class="qty-input" type="number" min="1" value="1">
    </div>

    <div style="margin-top:12px; display:flex; justify-content:space-between; align-items:center;">
      <div class="total">Total:</div>
      <div id="modalTotal" class="total">Rs. 0</div>
    </div>

    <div style="margin-top:14px; display:flex; gap:8px;">
      <button class="btn" id="confirmBuy">Confirm Purchase</button>
      <button class="btn secondary" id="cancelBuy">Cancel</button>
    </div>

  </div>
</div>

<!-- CHECKOUT MODAL (cart checkout) -->
<div id="checkoutBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="checkoutTitle">
    <button class="close-btn" id="checkoutClose">‚úï</button>
    <h3 id="checkoutTitle">Checkout</h3>

    <div style="margin-top:8px;">
      <label>Full name</label>
      <input id="checkoutName" placeholder="Your name" style="width:100%; padding:8px; border-radius:8px; margin-top:6px;">
      <label>Phone</label>
      <input id="checkoutPhone" placeholder="+94 7x xxx xxxx" style="width:100%; padding:8px; border-radius:8px; margin-top:6px;">
      <label>Delivery Address</label>
      <textarea id="checkoutAddress" placeholder="Address..." style="width:100%; padding:8px; border-radius:8px; margin-top:6px;"></textarea>
      <div style="display:flex; justify-content:space-between; margin-top:10px;">
        <div>Order Total</div><div id="checkoutTotal" style="font-weight:800;color:var(--accent2)">Rs. 0</div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px;">
        <button class="btn" id="payBtn">Pay (Demo)</button>
        <button class="btn secondary" id="cancelCheckout">Cancel</button>
      </div>
    </div>

  </div>
</div>

<!-- FOOTER -->
<footer class="footer">
  ¬© 2025 Sadew Coffee ‚Äî Crafted with ‚ù§ by Sadew Chamiks
</footer>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ================== CONFIGURE ==================
   Replace with your Firebase project's config.
=============================================== */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  databaseURL: "https://YOUR_PROJECT.firebaseio.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_ID",
  appId: "YOUR_APP_ID"
};
try {
  firebase.initializeApp(firebaseConfig);
  var db = firebase.database();
} catch(e){
  console.warn("Firebase init failed ‚Äî make sure to add your firebaseConfig", e);
  var db = null;
}

/* ---------- Sample products ---------- */
const PRODUCTS = [
  { id: 'p1', name:'Arabica Beans', price:1200, weight:'250g', img:'https://cdn.pixabay.com/photo/2017/06/02/18/24/coffee-2367417_1280.jpg' },
  { id: 'p2', name:'Robusta Blend', price:900, weight:'250g', img:'https://cdn.pixabay.com/photo/2017/09/25/13/12/coffee-2788663_1280.jpg' },
  { id: 'p3', name:'Espresso Roast', price:1500, weight:'250g', img:'https://cdn.pixabay.com/photo/2016/11/29/02/11/coffee-1869656_1280.jpg' },
  { id: 'p4', name:'Organic Coffee', price:1800, weight:'250g', img:'https://cdn.pixabay.com/photo/2017/01/20/00/30/coffee-1993141_1280.jpg' }
];

/* ---------- DOM refs ---------- */
const productGrid = document.getElementById('productGrid');
const buyModalBackdrop = document.getElementById('buyModalBackdrop');
const modalImg = document.getElementById('modalImg');
const modalName = document.getElementById('modalName');
const modalPrice = document.getElementById('modalPrice');
const modalQty = document.getElementById('modalQty');
const modalTotal = document.getElementById('modalTotal');
const modalClose = document.getElementById('modalClose');
const confirmBuy = document.getElementById('confirmBuy');
const cancelBuy = document.getElementById('cancelBuy');

const cartSidebar = document.getElementById('cartSidebar');
const openCartBtn = document.getElementById('openCartBtn');
const closeCartBtn = document.getElementById('closeCartBtn');
const cartItemsEl = document.getElementById('cartItems');
const cartSubtotalEl = document.getElementById('cartSubtotal');
const cartDeliveryEl = document.getElementById('cartDelivery');
const cartTotalEl = document.getElementById('cartTotal');
const cartCountEl = document.getElementById('cartCount');
const checkoutBtn = document.getElementById('checkoutBtn');
const clearCartBtn = document.getElementById('clearCartBtn');

const checkoutBackdrop = document.getElementById('checkoutBackdrop');
const checkoutTotalEl = document.getElementById('checkoutTotal');
const payBtn = document.getElementById('payBtn');
const cancelCheckout = document.getElementById('cancelCheckout');

/* ---------- Cart state (localStorage) ---------- */
function loadCart(){
  return JSON.parse(localStorage.getItem('demo_cart')||'[]');
}
function saveCart(cart){ localStorage.setItem('demo_cart', JSON.stringify(cart)); updateCartUI(); }
function addToCart(productId, qty=1){
  const p = PRODUCTS.find(x=>x.id===productId);
  if(!p) return;
  const cart = loadCart();
  const exist = cart.find(i=>i.id===productId);
  if(exist){ exist.qty += qty; }
  else{ cart.push({ id:p.id, name:p.name, price:p.price, img:p.img, qty }); }
  saveCart(cart);
}

/* ---------- Render products ---------- */
function renderProducts(){
  productGrid.innerHTML = '';
  PRODUCTS.forEach(p=>{
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <img class="product-thumb" src="${p.img}" alt="${p.name}">
      <div class="product-body">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 class="product-title">${p.name}</h3>
          <div class="product-price">Rs. ${p.price}</div>
        </div>
        <div style="color:var(--text); opacity:0.85;">${p.weight}</div>
        <div class="card-actions">
          <button class="btn buy-btn" data-id="${p.id}">Buy Now</button>
          <button class="btn secondary add-cart-btn" data-id="${p.id}">Add to Cart</button>
        </div>
      </div>
    `;
    productGrid.appendChild(card);
  });

  // attach touch handlers for overlay
  document.querySelectorAll('.product-card').forEach(card=>{
    card.addEventListener('touchstart', ()=> card.classList.add('touch-active'));
    card.addEventListener('touchend', ()=> setTimeout(()=> card.classList.remove('touch-active'), 300));
  });

  // attach buy handlers
  document.querySelectorAll('.buy-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = btn.getAttribute('data-id');
      openBuyModal(id);
    });
  });

  // attach add-to-cart handlers
  document.querySelectorAll('.add-cart-btn').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      const id = btn.getAttribute('data-id');
      addToCart(id,1);
      alert('Added to cart (demo).');
    });
  });
}

/* ---------- Buy Modal for single product ---------- */
let currentProduct = null;
function openBuyModal(productId){
  currentProduct = PRODUCTS.find(p=>p.id===productId);
  if(!currentProduct) return;
  modalImg.src = currentProduct.img;
  modalName.textContent = currentProduct.name;
  modalPrice.textContent = `Rs. ${currentProduct.price}`;
  modalQty.value = 1;
  updateModalTotal();
  buyModalBackdrop.classList.add('open');
  buyModalBackdrop.setAttribute('aria-hidden','false');
}
function updateModalTotal(){
  const qty = Math.max(1, parseInt(modalQty.value) || 1);
  const total = currentProduct.price * qty;
  modalTotal.textContent = `Rs. ${total.toLocaleString()}`;
}
function closeModal(){
  buyModalBackdrop.classList.remove('open');
  buyModalBackdrop.setAttribute('aria-hidden','true');
  currentProduct = null;
}
modalQty.addEventListener('input', updateModalTotal);
modalClose.addEventListener('click', closeModal);
cancelBuy.addEventListener('click', closeModal);
confirmBuy.addEventListener('click', async ()=>{
  const qty = Math.max(1, parseInt(modalQty.value) || 1);
  // add to cart and go to checkout
  addToCart(currentProduct.id, qty);
  closeModal();
  openCart();
  // auto open checkout
  setTimeout(()=> openCheckout(), 400);
});

/* ---------- Cart UI ---------- */
function updateCartUI(){
  const cart = loadCart();
  // count badge
  const count = cart.reduce((s,i)=>s+i.qty,0);
  if(count>0){ cartCountEl.style.display='inline-block'; cartCountEl.textContent = count; } else { cartCountEl.style.display='none'; }
  // items
  cartItemsEl.innerHTML = '';
  if(cart.length===0){
    cartItemsEl.innerHTML = '<div style="opacity:0.7">Your cart is empty.</div>';
  } else {
    cart.forEach(item=>{
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <img src="${item.img}" alt="${item.name}">
        <div style="flex:1;">
          <div style="display:flex; justify-content:space-between; align-items:center;">
            <div style="font-weight:700">${item.name}</div>
            <div style="color:var(--accent2); font-weight:800">Rs. ${item.price}</div>
          </div>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
            <div class="qty-controls">
              <button class="btn secondary qty-decrease" data-id="${item.id}">‚àí</button>
              <div style="padding:4px 8px; background:rgba(255,255,255,0.03); border-radius:6px; margin:0 6px;">${item.qty}</div>
              <button class="btn secondary qty-increase" data-id="${item.id}">+</button>
            </div>
            <button class="btn secondary remove-item" data-id="${item.id}">Remove</button>
          </div>
        </div>
      `;
      cartItemsEl.appendChild(div);
    });
  }
  // totals
  const subtotal = cart.reduce((s,i)=>s + i.price * i.qty,0);
  const delivery = cart.length>0 ? 150 : 0;
  const total = subtotal + delivery;
  cartSubtotalEl.textContent = `Rs. ${subtotal.toLocaleString()}`;
  cartDeliveryEl.textContent = `Rs. ${delivery}`;
  cartTotalEl.textContent = `Rs. ${total.toLocaleString()}`;
}

/* cart item controls (delegation) */
cartItemsEl.addEventListener('click', (e)=>{
  const target = e.target;
  if(target.classList.contains('qty-decrease') || target.classList.contains('qty-increase') || target.classList.contains('remove-item')){
    const id = target.getAttribute('data-id');
    const cart = loadCart();
    const idx = cart.findIndex(i=>i.id===id);
    if(idx===-1) return;
    if(target.classList.contains('qty-decrease')){ cart[idx].qty = Math.max(1, cart[idx].qty - 1); }
    if(target.classList.contains('qty-increase')){ cart[idx].qty = cart[idx].qty + 1; }
    if(target.classList.contains('remove-item')){ cart.splice(idx,1); }
    saveCart(cart);
  }
});

/* ---------- open/close cart ---------- */
function openCart(){ cartSidebar.classList.add('open'); cartSidebar.setAttribute('aria-hidden','false'); updateCartUI(); }
function closeCart(){ cartSidebar.classList.remove('open'); cartSidebar.setAttribute('aria-hidden','true'); }
openCartBtn.addEventListener('click', ()=> openCart());
closeCartBtn.addEventListener('click', ()=> closeCart());

clearCartBtn.addEventListener('click', ()=>{
  if(!confirm('Clear cart?')) return;
  saveCart([]);
});

/* ---------- Checkout (cart) ---------- */
function openCheckout(){
  const cart = loadCart();
  const subtotal = cart.reduce((s,i)=>s + i.price * i.qty,0);
  const delivery = cart.length>0 ? 150 : 0;
  const total = subtotal + delivery;
  checkoutTotalEl.textContent = `Rs. ${total.toLocaleString()}`;
  // prefill
  checkoutBackdrop.classList.add('open');
  checkoutBackdrop.setAttribute('aria-hidden','false');
}
function closeCheckout(){
  checkoutBackdrop.classList.remove('open');
  checkoutBackdrop.setAttribute('aria-hidden','true');
}
checkoutBtn.addEventListener('click', ()=> {
  openCheckout();
});
cancelCheckout.addEventListener('click', ()=> closeCheckout());
document.getElementById('checkoutClose').addEventListener('click', ()=> closeCheckout());

/* pay (demo) */
payBtn.addEventListener('click', async ()=>{
  const name = document.getElementById('checkoutName').value.trim() || 'Anonymous';
  const phone = document.getElementById('checkoutPhone').value.trim() || '';
  const addr = document.getElementById('checkoutAddress').value.trim() || '';
  const cart = loadCart();
  if(cart.length===0){ alert('Cart is empty'); return; }
  if(!addr){ alert('Enter delivery address'); return; }

  // compute totals
  const subtotal = cart.reduce((s,i)=>s + i.price * i.qty,0);
  const delivery = 150;
  const total = subtotal + delivery;

  payBtn.disabled = true; payBtn.textContent = 'Processing...';
  await new Promise(r=>setTimeout(r,1100)); // simulate payment

  // save order to firebase or local
  const order = { customerName:name, phone, address:addr, items:cart, subtotal, delivery, total, date:new Date().toISOString() };
  if(db){
    try {
      await db.ref('orders').push(order);
      console.log('Order saved to Firebase');
    } catch(err){
      console.warn('Failed to save order to Firebase', err);
      // fallback store locally
      const prev = JSON.parse(localStorage.getItem('demo_orders')||'[]'); prev.push(order); localStorage.setItem('demo_orders', JSON.stringify(prev));
    }
  } else {
    const prev = JSON.parse(localStorage.getItem('demo_orders')||'[]'); prev.push(order); localStorage.setItem('demo_orders', JSON.stringify(prev));
  }

  // success UI
  payBtn.textContent = 'Payment Successful ‚úî';
  saveCart([]); // clear cart
  updateCartUI();
  setTimeout(()=>{
    payBtn.disabled = false; payBtn.textContent = 'Pay (Demo)';
    closeCheckout(); closeCart();
    alert('Payment Successful! ‡∂î‡∂∂‡∂ú‡∑ö ‡∂á‡∂´‡∑Ä‡∑î‡∂∏ ‡∂Ω‡∑í‡∂∫‡∑è‡∂ú‡∂≠‡∑ä‡∂≠‡∑è. (Demo)');
  },900);
});

/* ---------- NAV interactions (hamburger + active link on scroll) ---------- */
const hamburgerEl = document.getElementById('hamburger');
const navLinks = document.getElementById('navLinks');
hamburgerEl.addEventListener('click', ()=> navLinks.classList.toggle('open'));

/* smooth close on link click + active highlight */
document.querySelectorAll('.nav-links a').forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault();
    const target = document.getElementById(a.getAttribute('data-target'));
    if(target) target.scrollIntoView({behavior:'smooth', block:'start'});
    navLinks.classList.remove('open');
  });
});

/* active link on scroll */
const sections = ['products','reviews','contact','admin'].map(id=>document.getElementById(id));
const navAnchors = Array.from(document.querySelectorAll('.nav-links a'));
function highlightNavOnScroll(){
  let index = 0;
  const fromTop = window.scrollY + 120;
  for(let i=0;i<sections.length;i++){
    if(sections[i] && sections[i].offsetTop <= fromTop) index = i;
  }
  navAnchors.forEach(a => a.classList.remove('active'));
  const active = navAnchors[index];
  if(active) active.classList.add('active');
}
window.addEventListener('scroll', highlightNavOnScroll);

/* ---------- THEME TOGGLE (persist) ---------- */
const themeToggle = document.getElementById('themeToggle');
function loadTheme(){
  const t = localStorage.getItem('sadew_theme') || 'dark';
  if(t==='light'){ document.body.setAttribute('data-theme','light'); themeToggle.textContent='‚òÄÔ∏è'; }
  else { document.body.removeAttribute('data-theme'); themeToggle.textContent='üåô'; }
}
themeToggle.addEventListener('click', ()=>{
  const current = document.body.getAttribute('data-theme');
  if(current==='light'){ document.body.removeAttribute('data-theme'); localStorage.setItem('sadew_theme','dark'); themeToggle.textContent='üåô'; }
  else { document.body.setAttribute('data-theme','light'); localStorage.setItem('sadew_theme','light'); themeToggle.textContent='‚òÄÔ∏è'; }
});
loadTheme();

/* ---------- Reviews (Firebase integration) ---------- */
const reviewList = document.getElementById('reviewList');
const submitReviewBtn = document.getElementById('submitReview');
async function loadReviews(){
  reviewList.innerHTML = '<div style="opacity:0.6">Loading reviews...</div>';
  if(!db){
    const sample = [
      {name:'Nadeesha', rating:5, text:'‡∑É‡∑î‡∂¥‡∑í‡∂ª‡∑í ‡∂ö‡∑ù‡∂¥‡∑í!'},
      {name:'Chamika', rating:4, text:'Latte ‡∂ë‡∂ö ‡∑Ñ‡∑ú‡∂≥‡∂∫‡∑í.'}
    ];
    renderReviews(sample);
    return;
  }
  try {
    const snap = await db.ref('reviews').once('value');
    const data = snap.val();
    const arr = data ? Object.keys(data).map(k => ({ id:k, ...data[k] })) : [];
    renderReviews(arr);
  } catch(err){
    console.warn('Read reviews failed', err);
    reviewList.innerHTML = '<div style="opacity:0.6">Failed to load reviews.</div>';
  }
}
function renderReviews(list){
  reviewList.innerHTML = '';
  if(!list || list.length === 0){
    reviewList.innerHTML = '<div style="opacity:0.7">No reviews yet ‚Äî be the first!</div>';
    return;
  }
  list.forEach(r=>{
    const el = document.createElement('div');
    el.className = 'review';
    el.innerHTML = `<strong>${r.name || 'Anonymous'}</strong> <small>‚≠êÔ∏è ${r.rating || 5}</small><p style="margin-top:6px">${r.text || r.comment || ''}</p>`;
    reviewList.appendChild(el);
  });
}
submitReviewBtn.addEventListener('click', async ()=>{
  const name = document.getElementById('reviewName').value.trim() || 'Anonymous';
  const rating = parseInt(document.getElementById('reviewRating').value) || 5;
  const text = document.getElementById('reviewText').value.trim();
  if(!text){ alert('‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∂Ö‡∂Ø‡∑Ñ‡∑É‡∂ö‡∑ä ‡∂ß‡∂∫‡∑í‡∂¥‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±'); return; }

  const reviewObj = { name, rating, text, date:new Date().toISOString() };
  if(db){
    try {
      await db.ref('reviews').push(reviewObj);
    } catch(e){
      console.warn('Failed to push review to Firebase', e);
      const local = JSON.parse(localStorage.getItem('demo_reviews')||'[]'); local.push(reviewObj); localStorage.setItem('demo_reviews', JSON.stringify(local));
    }
  } else {
    const local = JSON.parse(localStorage.getItem('demo_reviews')||'[]'); local.push(reviewObj); localStorage.setItem('demo_reviews', JSON.stringify(local));
  }
  document.getElementById('reviewName').value=''; document.getElementById('reviewRating').value=''; document.getElementById('reviewText').value='';
  setTimeout(()=> loadReviews(), 400);
});

/* ---------- ADMIN PANEL ---------- */
const adminLoginBtn = document.getElementById('adminLogin');
const adminPanel = document.getElementById('adminPanel');
const adminReviews = document.getElementById('adminReviews');
adminLoginBtn.addEventListener('click', async ()=>{
  const pass = document.getElementById('adminPass').value;
  if(pass !== 'admin123'){ alert('Wrong password'); return; }
  adminPanel.classList.remove('hidden'); adminPanel.style.display='block';
  if(!db){
    adminReviews.innerHTML = '<div style="opacity:0.6">Firebase not configured ‚Äî admin functions disabled.</div>';
    return;
  }
  try {
    const snap = await db.ref('reviews').once('value');
    const data = snap.val();
    adminReviews.innerHTML = '';
    if(!data){ adminReviews.innerHTML = '<div style="opacity:0.6">No reviews</div>'; return; }
    Object.keys(data).forEach(k=>{
      const r = data[k];
      const div = document.createElement('div');
      div.className = 'review';
      div.innerHTML = `<strong>${r.name}</strong><small>‚≠êÔ∏è ${r.rating}</small><p>${r.text || r.comment || ''}</p>
        <div style="margin-top:8px"><button onclick="adminDelete('${k}')" class="btn secondary">Delete</button></div>`;
      adminReviews.appendChild(div);
    });
  } catch(e){ adminReviews.innerHTML = '<div style="opacity:0.6">Failed to load admin reviews.</div>'; }
});
window.adminDelete = async function(id){
  if(!confirm('Delete this review?')) return;
  if(!db){ alert('Firebase not configured'); return; }
  try { await db.ref('reviews/'+id).remove(); alert('Deleted'); loadReviews(); adminLoginBtn.click(); } catch(e){ alert('Delete failed'); }
}

/* ---------- INITIALIZE ---------- */
renderProducts();
loadReviews();
updateCartUI();
highlightNavOnScroll();

/* animate sections on load */
window.addEventListener('load', ()=> {
  document.querySelectorAll('.section').forEach((s,i)=>{
    s.style.opacity = 0; s.style.transform = 'translateY(14px)';
    setTimeout(()=> { s.style.transition = 'opacity .6s, transform .6s'; s.style.opacity = 1; s.style.transform = 'translateY(0)'; }, 120 + i*80);
  });
});
</script>
</body>
</html>
